(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{487:function(a,t,s){a.exports=s.p+"assets/img/image-20220626132405474.710d018d.png"},488:function(a,t,s){a.exports=s.p+"assets/img/image-20220626133845716.aa5d455f.png"},702:function(a,t,s){"use strict";s.r(t);var e=s(4),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("在公司搭建npm的私服，可以保证公司的组件安全，员工内网访问也比较快速。")]),a._v(" "),e("p",[a._v("在这里推荐verdaccio，特别简单好用")]),a._v(" "),e("h2",{attrs:{id:"一、verdaccio-框架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、verdaccio-框架"}},[a._v("#")]),a._v(" 一、Verdaccio 框架")]),a._v(" "),e("p",[a._v("Verdaccio 是一个 Node.js 创建的轻量的私有 npm proxy registry。")]),a._v(" "),e("ul",[e("li",[a._v("基于 Node.js 的网页应用程序")]),a._v(" "),e("li",[a._v("私有 npm registry")]),a._v(" "),e("li",[a._v("本地网络 proxy")]),a._v(" "),e("li",[a._v("可插入式应用程序")]),a._v(" "),e("li",[a._v("易安装和使用")]),a._v(" "),e("li",[a._v("提供 Docker 和 Kubernetes 支持")]),a._v(" "),e("li",[a._v("与 yarn, npm 和 pnpm 100% 兼容")]),a._v(" "),e("li",[a._v("forked 于 sinopia@1.4.0 并且 100% 向后兼容。")])]),a._v(" "),e("p",[e("img",{attrs:{src:s(487),alt:"image-20220626132405474"}})]),a._v(" "),e("h2",{attrs:{id:"二、内网安装和使用verdaccio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、内网安装和使用verdaccio"}},[a._v("#")]),a._v(" 二、内网安装和使用verdaccio")]),a._v(" "),e("p",[a._v("注意下面提到的 http://192.168.xxx.xxx 均为自己内网的服务器ip地址")]),a._v(" "),e("h3",{attrs:{id:"_2-1-nodejs-环境下全局安装-verdaccio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-nodejs-环境下全局安装-verdaccio"}},[a._v("#")]),a._v(" 2.1 Nodejs 环境下全局安装 verdaccio")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g verdaccio\n")])])]),e("h3",{attrs:{id:"_2-2-修改配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-修改配置文件"}},[a._v("#")]),a._v(" 2.2 修改配置文件")]),a._v(" "),e("p",[a._v("打开默认启动的 config.yaml 文件：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /root/.config/verdaccio/config.yaml\n")])])]),e("p",[a._v("👇")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("auth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("htpasswd")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ./htpasswd\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# Maximum amount of users allowed to register, defaults to "+inf".')]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# You can set this to -1 to disable registration.")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("-1")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("uplinks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("npmjs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//registry.npmjs.org/\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cnpm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//registry.npm.taobao.org\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("packages")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"@aemp/*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("publish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("unpublish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"@*/*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $all\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("publish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("unpublish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cnpm\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"**"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $all\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("publish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("unpublish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cnpm\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("listen")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.0.0.0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4873")]),a._v("\n")])])]),e("p",[a._v("access 是访问权限控制，总共有三种身份：所有人($all)、匿名用户($anonymous)、认证(登陆)用户($authenticated)。")]),a._v(" "),e("p",[a._v("在最下方添加 对外暴露的端口")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("listen: "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:4873\n")])])]),e("ul",[e("li",[a._v("storage：#所有包的缓存目录 建议修改如："),e("code",[a._v("D:\\npmPackes\\storage")])]),a._v(" "),e("li",[a._v("proxy:代理 表示没有的包verdaccio库会去这个npmjs (即配置中"),e("code",[a._v("https://registry.npmjs.org/")]),a._v(") 或 cnpm 里面去找.")])]),a._v(" "),e("h3",{attrs:{id:"_2-3-启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动"}},[a._v("#")]),a._v(" 2.3 启动")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("verdaccio\n")])])]),e("p",[e("img",{attrs:{src:s(488),alt:"image-20220626133845716"}})]),a._v(" "),e("p",[a._v("如果 verdaccio不能直接执行, 如")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("-bash: verdaccio: 未找到命令\n")])])]),e("p",[a._v("是因为没有自动注册到全局的命令，需要映射下，格式如下，命令中具体位置得看自己的实际情况")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" -s /usr/src/node-v12.13.0-linux-x64/bin/pm2 /usr/local/bin/\n")])])]),e("p",[a._v("这时候在内网中访问 "),e("code",[a._v("http://192.168.xxx.xxx:4873")]),a._v(" 就可以访问了。")]),a._v(" "),e("p",[a._v("但是情况我们关闭命令行窗口之后，服务就停止了，那么我们就需要使用pm2进行进程守护。")]),a._v(" "),e("h2",{attrs:{id:"三、使用pm2进程守护"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、使用pm2进程守护"}},[a._v("#")]),a._v(" 三、使用pm2进程守护")]),a._v(" "),e("h3",{attrs:{id:"_3-1-安装和使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装和使用"}},[a._v("#")]),a._v(" 3.1 安装和使用")]),a._v(" "),e("p",[a._v("pm2的使用可以看我19年整理的一个博客 👉"),e("a",{attrs:{href:"https://hunterxing.github.io/notes/notes/server/nginx/%E5%88%A9%E7%94%A8pm2%E8%BF%9B%E8%A1%8Cnode%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("利用pm2进行node的进程守护"),e("OutboundLink")],1)]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g pm2\npm2 start verdaccio\n")])])]),e("p",[a._v("注意此时如果 pm2 未找到命令，也需要和2.3中一样使用ln进行映射")]),a._v(" "),e("p",[a._v("这时候关闭控制台也能让这个node服务持久化运行")]),a._v(" "),e("h2",{attrs:{id:"四、用户管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、用户管理"}},[a._v("#")]),a._v(" 四、用户管理")]),a._v(" "),e("h3",{attrs:{id:"_3-1-添加用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-添加用户"}},[a._v("#")]),a._v(" 3.1 添加用户")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" adduser --registry http://192.168.xxx.xxx:4873\n")])])]),e("p",[a._v("npm adduser --registry http://192.168.59.235:8062")]),a._v(" "),e("p",[a._v("输入 username、password 以及 Email 即可")]),a._v(" "),e("h3",{attrs:{id:"_3-2-登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-登录"}},[a._v("#")]),a._v(" 3.2 登录")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" login --registry http://192.168.xxx.xxx:4873\n")])])]),e("h3",{attrs:{id:"_3-3-上传私有包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-上传私有包"}},[a._v("#")]),a._v(" 3.3 上传私有包")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" publish --registry http://192.168.xxx.xxx:4873\n")])])]),e("h3",{attrs:{id:"_3-4-其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-其他"}},[a._v("#")]),a._v(" 3.4 其他")]),a._v(" "),e("p",[a._v("上述的操作每次都要指定源registry，可以使用 nrm进行快速切换 npm的镜像源")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("nrm "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" verdaccio http://192.168.xxx.xxx:4873\n\nnrm use verdaccio\n")])])]),e("p",[a._v("此处不赘述nrm的使用方法。")]),a._v(" "),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"http://blog.fens.me/nodejs-cnpm-npm",target:"_blank",rel:"noopener noreferrer"}},[a._v("CNPM 搭建私有的 NPM 服务"),e("OutboundLink")],1)])]),a._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/jaywcjlove/handbook/blob/master/CentOS/%E5%9C%A85%E5%88%86%E9%92%9F%E5%86%85%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E5%86%85%E9%83%A8%E7%A7%81%E6%9C%89npm%E4%BB%93%E5%BA%93.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("在 5 分钟内搭建企业内部私有 npm 仓库"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);t.default=n.exports}}]);